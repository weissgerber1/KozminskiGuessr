<!DOCTYPE html>
<html>
<head>
    <title>Contribute - Kozminski Guessr</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/contribute.css') }}">
    <style>
        .container { text-align: center; margin-top: 50px; }
    </style>
</head>
<body>
    <div class="header">
        <!-- Left side of the header -->
        <div class="header-left">
            <button onclick="location.href='/'">Main</button>
            <button onclick="location.href='/leaderboard'">Leaderboard</button>
            <button onclick="location.href='/contribute'">Contribute</button>
        </div>
    
        <!-- Right side of the header with user login / logout functionality -->
        <div class="header-right">
            {% if current_user %}
                <div class="user-menu">
                    <button class="user-menu-button">
                        {{ current_user.username }}
                        {% if current_user.is_guest %}(Guest){% endif %}
                    </button>
                    <div class="user-menu-dropdown">
                        <a href="{{ url_for('logout') }}">Log out</a>
                    </div>
                </div>
            {% else %}
                <button onclick="location.href='{{ url_for('login') }}'">Log In</button>
            {% endif %}
        </div>
    </div>

    <div class="contribute-title">
        Contribute
        <svg class="border-svg" viewBox="0 0 100 40" preserveAspectRatio="none">
            <rect x="2" y="2" width="96" height="36" rx="10" ry="10" />
        </svg>
    </div>
    <img src="{{ url_for('static', filename='images/hands_contr.png') }}" alt="Contribute Image" class="title-image">
    

    <div class="container">
        {% if message %}<p class="thank-you-message">{{ message }}</p>{% endif %}
        <form method="POST" enctype="multipart/form-data" onsubmit="return confirm('Are you sure?');">

            <!-- File input on the first row (this is on its own line) -->
            <div class="form-row">
                <input type="file" name="image" accept="image/*" required>
            </div>
            
            <!-- Building, Floor, and Classroom on the next row (this is horizontally aligned) -->
            <div class="form-row">
                <select id="building" name="building">
                    <option value="">Select Building</option>
                    <option value="A">Building A</option>
                    <option value="B">Building B</option>
                    <option value="C">Building C</option>
                    <option value="D">Building D</option>
                </select>
                <select id="floor" name="floor">
                    <option value="">Select Floor</option>
                    <option value="0">0 Floor</option>
                    <option value="1">1st Floor</option>
                    <option value="2">2nd Floor</option>
                    <option value="3">3rd Floor</option>
                </select>
                <input id="classroom" list="classroom-list" name="classroom_number" placeholder="Classroom..." required>
                <datalist id="classroom-list"></datalist>
                <input type="hidden" id="classroom_id" name="classroom_id">
            </div>

            <!-- Submit button -->
            <button type="submit">SUBMIT</button>
        </form>
    </div>
    
    <script>
        async function updateClassroomList() {
            const building = document.getElementById('building').value;
            const floor = document.getElementById('floor').value;
            const response = await fetch(`/api/classrooms?building=${building}&floor=${floor}`);
            const classrooms = await response.json();
            const datalist = document.getElementById('classroom-list');
            datalist.innerHTML = classrooms.map(c => `<option value="${c.classroom_number}" data-id="${c.id}">`).join('');
        }

        // Update classroom_id when classroom input changes
        document.getElementById('classroom').addEventListener('change', function() {
            const datalist = document.getElementById('classroom-list');
            const selectedValue = this.value;
            const selectedOption = datalist.querySelector(`option[value="${selectedValue}"]`);
            const classroomId = selectedOption ? selectedOption.getAttribute('data-id') : '';
            document.getElementById('classroom_id').value = classroomId;
            console.log('Selected classroom_id:', classroomId);
        });

        // Update classroom list when building or floor changes
        document.getElementById('building').addEventListener('change', updateClassroomList);
        document.getElementById('floor').addEventListener('change', updateClassroomList);

        // Initial update
        updateClassroomList();
    </script>
</body>
</html>
