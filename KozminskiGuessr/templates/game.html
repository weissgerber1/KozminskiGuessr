<!DOCTYPE html>
<html>
<head>
    <title>Game - Kozminski Guessr</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/game.css') }}">
    <style>
        #game-container { text-align: center; margin-top: 80px; }
        #score-ticker { position: fixed; left: 30px; top: 40%; font-size: 24px; }
        #error-message { color: red; margin-top: 20px; font-size: 16px; }
        #building.correct, #floor.correct, #classroom.correct { border-color: green; background-color: #e0ffe0; }
        #building.incorrect, #floor.incorrect, #classroom.incorrect { border-color: red; background-color: #ffe0e0; }
        #round-counter { position: fixed; left: 30px; top: 20px; font-size: 22px; }
        #points-explanation { position: fixed; right: 30px; top: 20px; width: 300px; text-align: left; font-size: 18px; }
        #score-image { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <!-- Left side of the header -->
        <div class="header-left">
            <button onclick="location.href='/'">Main</button>
            <button onclick="location.href='/leaderboard'">Leaderboard</button>
            <button onclick="location.href='/contribute'">Contribute</button>
        </div>
    
        <!-- Right side of the header with user login / logout functionality -->
        <div class="header-right">
            {% if current_user %}
                <div class="user-menu">
                    <button class="user-menu-button">
                        {{ current_user.username }}
                        {% if current_user.is_guest %}(Guest){% endif %}
                    </button>
                    <div class="user-menu-dropdown">
                        <a href="{{ url_for('logout') }}">Log out</a>
                    </div>
                </div>
            {% else %}
                <button onclick="location.href='{{ url_for('login') }}'">Log In</button>
            {% endif %}
        </div>
    </div>

    <div id="score-ticker">Score: 0</div>
    <div id="round-counter">Round: 1/5</div>
    <img id="score-image" src="/static/images/lion_game.png" alt="Score Image" style="max-width: 100px;">
    <div id="game-container">
        <img id="classroom-image" src="" alt="Classroom" style="max-width: 50%;">
        <div>
            <select id="building">
                <option value="">Select Building</option>
                <option value="A">Building A</option>
                <option value="B">Building B</option>
                <option value="C">Building C</option>
                <option value="D">Building D</option>
            </select>
            <select id="floor">
                <option value="">Select Floor</option>
                <option value="0">0 Floor</option>
                <option value="1">1st Floor</option>
                <option value="2">2nd Floor</option>
                <option value="3">3rd Floor</option>
            </select>
            <input id="classroom" list="classroom-list" placeholder="Classroom...">
            <datalist id="classroom-list"></datalist>
        </div>
        <button id="guess-btn">GUESS</button>
        <div id="feedback"></div>
        <div id="error-message"></div>
        <div id="summary" style="display: none;"></div>
    </div>
    <div id="points-explanation">
        <h3>How Points Work</h3>
        <p>
            - Correct classroom: +5 points<br>
            - Correct building and floor: +3 points<br>
            - Correct floor only: +2 points<br>
            - Correct building only: +1 point<br>
            - Everything incorrect: 0 pointsðŸ˜­
        </p>
    </div>
    <script>
        // error handling to ensure game.js loads and DOM elements are present
        window.onload = function() {
            if (typeof startGame !== 'function') {
                document.getElementById('error-message').textContent = 'Error: Game script failed to load. Please refresh the page.';
                return;
            }
            // verify required DOM elements
            const requiredElements = ['score-ticker', 'game-container', 'classroom-image', 'building', 'floor', 'classroom', 'classroom-list', 'guess-btn', 'feedback', 'summary', 'round-counter'];
            for (const id of requiredElements) {
                if (!document.getElementById(id)) {
                    document.getElementById('error-message').textContent = `Error: Missing required element "${id}". Please contact support.`;
                    return;
                }
            }
        };
    </script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9367ac585e3ebca8',t:'MTc0NTY4NzIxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>